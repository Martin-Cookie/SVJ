<div class="mb-6">
    <a href="{{ back_url|default('/hlasovani') }}" class="text-sm text-gray-500 hover:text-gray-700">&larr; {{ back_label|default('Zpět na hlasování') }}</a>
</div>

<div class="flex items-center justify-between mb-6">
    <div>
        <h1 class="text-2xl font-bold text-gray-800">{{ voting.title }}</h1>
        <div class="flex items-center mt-2 space-x-3">
            {% if voting.status.value == 'draft' %}
            <span class="px-3 py-1 text-xs font-medium bg-gray-100 text-gray-800 rounded-full">Koncept</span>
            {% elif voting.status.value == 'active' %}
            <span class="px-3 py-1 text-xs font-medium bg-green-100 text-green-800 rounded-full">Aktivní</span>
            {% elif voting.status.value == 'closed' %}
            <span class="px-3 py-1 text-xs font-medium bg-blue-100 text-blue-800 rounded-full">Uzavřeno</span>
            {% endif %}
            {% if voting.start_date %}<span class="text-sm text-gray-500">Od: {{ voting.start_date.strftime('%d.%m.%Y') }}</span>{% endif %}
            {% if voting.end_date %}<span class="text-sm text-gray-500">Do: {{ voting.end_date.strftime('%d.%m.%Y') }}</span>{% endif %}
        </div>
    </div>
    <div class="flex gap-2">
        {% if voting.status.value == 'draft' %}
        <form action="/hlasovani/{{ voting.id }}/generovat" method="post">
            <button type="submit" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 text-sm font-medium">
                Generovat lístky
            </button>
        </form>
        {% endif %}
        {% if voting.status.value != 'draft' %}
        <a href="/hlasovani/{{ voting.id }}/zpracovani" class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 text-sm font-medium">
            Zpracovat výsledky
        </a>
        {% endif %}
    </div>
</div>

{% if voting.status.value != 'draft' %}
<!-- Status overview -->
<div class="flex gap-4 mb-4">
    <a href="/hlasovani/{{ voting.id }}/listky"
       class="flex-1 bg-white rounded-lg shadow p-4 text-center hover:shadow-md transition-shadow
              {% if active_bubble == 'all' %}ring-2 ring-gray-400{% endif %}">
        <p class="text-2xl font-bold text-gray-800">{{ total_ballots }}</p>
        <p class="text-xs text-gray-500 mt-1">Celkem lístků</p>
    </a>
    <a href="/hlasovani/{{ voting.id }}/listky?stav=generated"
       class="flex-1 bg-white rounded-lg shadow p-4 text-center hover:shadow-md transition-shadow
              {% if active_bubble == 'generated' %}ring-2 ring-blue-400{% endif %}">
        <p class="text-2xl font-bold text-blue-600">{{ status_counts.get('generated', 0) }}</p>
        <p class="text-xs text-gray-500 mt-1">Zbývá zpracovat</p>
    </a>
    <a href="/hlasovani/{{ voting.id }}/listky?stav=sent"
       class="flex-1 bg-white rounded-lg shadow p-4 text-center hover:shadow-md transition-shadow
              {% if active_bubble == 'sent' %}ring-2 ring-yellow-400{% endif %}">
        <p class="text-2xl font-bold text-yellow-600">{{ status_counts.get('sent', 0) }}</p>
        <p class="text-xs text-gray-500 mt-1">Odesláno</p>
    </a>
    <a href="/hlasovani/{{ voting.id }}/listky?stav=processed"
       class="flex-1 bg-white rounded-lg shadow p-4 text-center hover:shadow-md transition-shadow
              {% if active_bubble == 'processed' %}ring-2 ring-green-400{% endif %}">
        <p class="text-2xl font-bold text-green-600">{{ status_counts.get('processed', 0) }}</p>
        <p class="text-xs text-gray-500 mt-1">Zpracováno</p>
    </a>
    <a href="/hlasovani/{{ voting.id }}/neodevzdane"
       class="flex-1 bg-white rounded-lg shadow p-4 text-center hover:shadow-md transition-shadow
              {% if active_bubble == 'neodevzdane' %}ring-2 ring-orange-400{% endif %}">
        <p class="text-2xl font-bold text-orange-600">{{ total_ballots - status_counts.get('processed', 0) }}</p>
        <p class="text-xs text-gray-500 mt-1">Neodevzdané</p>
    </a>
    <div class="flex-1 bg-white rounded-lg shadow p-4 text-center">
        {% set quorum_pct = (total_processed_votes / voting.total_votes_possible * 100)|round(1) if voting.total_votes_possible else 0 %}
        <p class="text-2xl font-bold {% if quorum_reached %}text-green-600{% else %}text-red-600{% endif %}">
            {{ quorum_pct }}%
        </p>
        <p class="text-xs text-gray-500 mt-1">
            Kvórum ({{ (voting.quorum_threshold * 100)|round(0)|int }}%)
            {% if quorum_reached %}<span class="text-green-600 font-semibold">Dosaženo</span>{% endif %}
        </p>
    </div>
</div>
{% endif %}
