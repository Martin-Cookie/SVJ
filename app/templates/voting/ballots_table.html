{% for ballot in ballots %}
{% set vote_map = {} %}
{% for bv in ballot.votes %}
    {% if vote_map.update({bv.voting_item_id: bv}) %}{% endif %}
{% endfor %}
<tr class="hover:bg-gray-50">
    <td class="px-4 py-2">
        <a href="/hlasovani/{{ voting.id }}/listek/{{ ballot.id }}" class="font-medium text-blue-600 hover:text-blue-800 hover:underline">
            {{ ballot.owner.display_name }}
        </a>
    </td>
    <td class="px-4 py-2 text-gray-500">{{ ballot.units_text }}</td>
    <td class="px-4 py-2 text-gray-500 text-right font-mono">{{ "{:,}".format(ballot.total_votes).replace(",", " ") }}</td>
    {% for item in voting.items %}
    {% set bv = vote_map.get(item.id) %}
    <td class="px-3 py-2 text-center">
        {% if bv and bv.vote %}
            {% if bv.vote.value == 'for' %}
            <span class="px-2 py-0.5 text-xs font-medium bg-green-100 text-green-700 rounded-full">PRO</span>
            {% elif bv.vote.value == 'against' %}
            <span class="px-2 py-0.5 text-xs font-medium bg-red-100 text-red-700 rounded-full">PROTI</span>
            {% elif bv.vote.value == 'abstain' %}
            <span class="px-2 py-0.5 text-xs font-medium bg-gray-100 text-gray-500 rounded-full">Zdržel</span>
            {% endif %}
        {% else %}
        <span class="text-gray-300">—</span>
        {% endif %}
    </td>
    {% endfor %}
    <td class="px-4 py-2 text-gray-500">
        {% if ballot.voted_by_proxy %}
        <span class="px-2 py-1 text-xs bg-yellow-100 text-yellow-800 rounded">{{ ballot.proxy_holder_name }}</span>
        {% else %}—{% endif %}
    </td>
    <td class="px-4 py-2">
        {% if ballot.status.value == 'generated' %}
        <span class="px-2 py-1 text-xs font-medium bg-gray-100 text-gray-800 rounded-full">Vygenerován</span>
        {% elif ballot.status.value == 'sent' %}
        <span class="px-2 py-1 text-xs font-medium bg-blue-100 text-blue-800 rounded-full">Odeslán</span>
        {% elif ballot.status.value == 'received' %}
        <span class="px-2 py-1 text-xs font-medium bg-yellow-100 text-yellow-800 rounded-full">Přijat</span>
        {% elif ballot.status.value == 'processed' %}
        <span class="px-2 py-1 text-xs font-medium bg-green-100 text-green-800 rounded-full">Zpracován</span>
        {% endif %}
    </td>
</tr>
{% endfor %}
