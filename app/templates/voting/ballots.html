{% extends "base.html" %}
{% block title %}Hlasovací lístky - {{ voting.title }}{% endblock %}

{% block content %}
<div class="mb-6">
    <a href="/hlasovani/{{ voting.id }}" class="text-sm text-gray-500 hover:text-gray-700">&larr; Zpět na hlasování</a>
</div>

<h1 class="text-2xl font-bold text-gray-800 mb-6">Hlasovací lístky - {{ voting.title }}</h1>

<!-- Status filter bubbles (static) -->
{% set _bbase = "/hlasovani/" ~ voting.id ~ "/listky?" %}
<div class="flex gap-4 mb-4">
    <a href="{{ _bbase }}stav="
       hx-get="{{ _bbase }}stav="
       hx-target="#ballots-area" hx-swap="innerHTML" hx-push-url="true"
       class="flex-1 flex flex-col items-center py-2 px-3 rounded-lg text-center transition-colors
              {% if not current_stav %}bg-purple-100 ring-2 ring-purple-400 text-purple-800{% else %}bg-white shadow text-gray-600 hover:bg-gray-50{% endif %}">
        <span class="text-lg font-bold">{{ status_counts.all }}</span>
        <span class="text-xs">Vše</span>
    </a>
    <a href="{{ _bbase }}stav=generated"
       hx-get="{{ _bbase }}stav=generated"
       hx-target="#ballots-area" hx-swap="innerHTML" hx-push-url="true"
       class="flex-1 flex flex-col items-center py-2 px-3 rounded-lg text-center transition-colors
              {% if current_stav == 'generated' %}bg-blue-100 ring-2 ring-blue-400 text-blue-800{% else %}bg-white shadow text-gray-600 hover:bg-gray-50{% endif %}">
        <span class="text-lg font-bold">{{ status_counts.get('generated', 0) }}</span>
        <span class="text-xs">Zbývá zpracovat</span>
    </a>
    <a href="{{ _bbase }}stav=sent"
       hx-get="{{ _bbase }}stav=sent"
       hx-target="#ballots-area" hx-swap="innerHTML" hx-push-url="true"
       class="flex-1 flex flex-col items-center py-2 px-3 rounded-lg text-center transition-colors
              {% if current_stav == 'sent' %}bg-yellow-100 ring-2 ring-yellow-400 text-yellow-800{% else %}bg-white shadow text-gray-600 hover:bg-gray-50{% endif %}">
        <span class="text-lg font-bold">{{ status_counts.get('sent', 0) }}</span>
        <span class="text-xs">Odesláno</span>
    </a>
    <a href="{{ _bbase }}stav=processed"
       hx-get="{{ _bbase }}stav=processed"
       hx-target="#ballots-area" hx-swap="innerHTML" hx-push-url="true"
       class="flex-1 flex flex-col items-center py-2 px-3 rounded-lg text-center transition-colors
              {% if current_stav == 'processed' %}bg-green-100 ring-2 ring-green-400 text-green-800{% else %}bg-white shadow text-gray-600 hover:bg-gray-50{% endif %}">
        <span class="text-lg font-bold">{{ status_counts.get('processed', 0) }}</span>
        <span class="text-xs">Zpracováno</span>
    </a>
</div>

<!-- Search (static) -->
<div class="mb-4">
    <input type="text" name="q" value="{{ q }}" placeholder="Hledat vlastníka..."
           hx-get="/hlasovani/{{ voting.id }}/listky"
           hx-trigger="keyup changed delay:300ms"
           hx-target="#ballots-area"
           hx-swap="innerHTML"
           hx-include="#ballots-area [name='sort'], #ballots-area [name='order'], #ballots-area [name='stav']"
           hx-push-url="true"
           class="w-full px-3 py-1.5 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
</div>

<!-- Ballots area (dynamic, HTMX-updated) -->
<div id="ballots-area">
    {% include "voting/ballots_table.html" %}
</div>
{% endblock %}
