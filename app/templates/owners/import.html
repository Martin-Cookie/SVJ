{% extends "base.html" %}
{% block title %}Import vlastníků - SVJ Správa{% endblock %}

{% block content %}
<div class="flex flex-col" style="height:calc(100vh - 48px)">
    <div class="mb-3 flex-none">
        <a href="/vlastnici" class="text-sm text-gray-500 hover:text-gray-700">&larr; Zpět na seznam vlastníků</a>
    </div>
    <h1 class="text-xl font-bold text-gray-800 mb-4 flex-none">Import vlastníků z Excelu</h1>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 items-start flex-1 min-h-0">
        <!-- Left: upload form (static) -->
        <div class="bg-white rounded-lg shadow p-6">
            <h2 class="text-sm font-semibold text-gray-700 mb-3">Nahrát soubor</h2>
            <div class="mb-4">
                <p class="text-sm text-gray-600 mb-2">Soubor musí být ve formátu <strong>.xlsx</strong> s listem Sheet1. Očekávané sloupce:</p>
                <ul class="text-xs text-gray-500 list-disc list-inside space-y-0.5">
                    <li><strong>A</strong> - Jméno vlastníka</li>
                    <li><strong>B</strong> - Plná moc</li>
                    <li><strong>C</strong> - Číslo jednotky</li>
                    <li><strong>D</strong> - Sub-číslo jednotky</li>
                    <li><strong>E</strong> - Spoluvlastnický podíl</li>
                    <li><strong>G</strong> - Počet hlasů</li>
                </ul>
            </div>

            <div class="bg-yellow-50 border border-yellow-200 rounded p-3 mb-4">
                <p class="text-xs text-yellow-700">
                    <strong>Pozor:</strong> Import nahradí všechny stávající vlastníky v databázi.
                </p>
            </div>

            <form action="/vlastnici/import" method="post" enctype="multipart/form-data">
                <div class="mb-3">
                    <input type="file" name="file" accept=".xlsx,.xls" required
                           class="block w-full text-sm text-gray-500 file:mr-4 file:py-1.5 file:px-3
                                  file:rounded file:border-0 file:text-sm file:font-medium
                                  file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
                </div>
                <button type="submit" class="px-4 py-1.5 bg-blue-600 text-white rounded hover:bg-blue-700 text-sm font-medium">
                    Nahrát a zobrazit náhled
                </button>
            </form>
        </div>

        <!-- Right: history (only tbody scrolls) -->
        <div class="bg-white rounded-lg shadow flex flex-col min-h-0 h-full">
            <div class="px-4 pt-4 flex-none">
                <h2 class="text-sm font-semibold text-gray-700 mb-2">Historie importů</h2>
            </div>
            {% if imports %}
            <div class="flex-none px-4">
                <table class="w-full text-sm">
                    <thead class="border-b border-gray-200">
                        <tr>
                            <th class="px-3 py-1.5 text-left font-medium text-gray-500">Soubor</th>
                            <th class="px-3 py-1.5 text-left font-medium text-gray-500">Datum</th>
                            <th class="px-3 py-1.5 text-right font-medium text-gray-500">Řádků</th>
                            <th class="px-3 py-1.5 text-right font-medium text-gray-500">Vlastníků</th>
                            <th class="px-3 py-1.5"></th>
                        </tr>
                    </thead>
                </table>
            </div>
            <div class="flex-1 overflow-y-auto px-4 pb-4 min-h-0">
                <table class="w-full text-sm">
                    <tbody class="divide-y divide-gray-100">
                        {% for log in imports %}
                        <tr class="hover:bg-gray-50">
                            <td class="px-3 py-1.5 text-gray-800">{{ log.filename }}</td>
                            <td class="px-3 py-1.5 text-gray-500 text-xs" style="white-space:nowrap">{{ log.created_at.strftime('%d.%m.%Y %H:%M') }}</td>
                            <td class="px-3 py-1.5 text-gray-500 text-right">{{ log.rows_total }}</td>
                            <td class="px-3 py-1.5 text-gray-500 text-right">{{ log.rows_imported }}</td>
                            <td class="px-3 py-1.5 text-right">
                                <form action="/vlastnici/import/{{ log.id }}/smazat" method="post" style="display:inline"
                                      onsubmit="return confirm('Smazat import {{ log.filename }}? Odstraní se všichni vlastníci, jednotky a přiřazení.')">
                                    <button type="submit" class="text-red-500 hover:text-red-700 text-xs font-medium">Smazat</button>
                                </form>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="px-4 pb-4">
                <p class="text-sm text-gray-400">Zatím žádné importy.</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
